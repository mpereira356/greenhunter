{% extends "base.html" %}
{% block title %}Minhas Regras | GreenHunter{% endblock %}
{% block content %}
<div class="page-header">
  <div>
    <h1 class="page-title">Minhas Regras</h1>
    <p class="page-subtitle">Gerencie seus bots e acompanhe o desempenho individual.</p>
  </div>
  <div class="page-actions">
    <a class="btn btn-primary shadow-sm" href="{{ url_for('rules.create_rule') }}">
      <span class="me-1">+</span> Nova Regra
    </a>
  </div>
</div>

{% if rules %}
  <div class="card border-0 shadow-sm">
    <div class="table-responsive">
      <table class="table table-clean align-middle mb-0">
        <thead>
          <tr>
            <th>Nome da Regra</th>
            <th>Status</th>
            <th class="text-center">Greens</th>
            <th class="text-center">Reds</th>
            <th>√öltimo Alerta</th>
            <th class="text-end">A√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          {% for rule in rules %}
          <tr>
            <td>
              <div class="fw-bold text-main">{{ rule.name }}</div>
              <div class="small text-muted">{{ rule.conditions|length }} condi√ß√µes configuradas</div>
            </td>
            <td>
              {% if rule.is_active %}
                <span class="badge-status badge-on">‚óè Ativa</span>
              {% else %}
                <span class="badge-status badge-off">‚óè Inativa</span>
              {% endif %}
            </td>
            <td class="text-center fw-bold text-success">{{ rule_stats.get(rule.id, {}).get("green", 0) }}</td>
            <td class="text-center fw-bold text-danger">{{ rule_stats.get(rule.id, {}).get("red", 0) }}</td>
            <td class="text-muted small">
              {{ rule.last_alert_at.strftime('%d/%m %H:%M') if rule.last_alert_at else 'Nenhum' }}
            </td>
            <td class="text-end">
              <div class="d-flex justify-content-end gap-2">
                <form method="post" action="{{ url_for('rules.toggle_rule', rule_id=rule.id) }}" class="d-inline">
                  <button class="btn btn-sm btn-outline-secondary">
                    {% if rule.is_active %}Pausar{% else %}Ativar{% endif %}
                  </button>
                </form>
                <a class="btn btn-sm btn-outline-primary" href="{{ url_for('rules.edit_rule', rule_id=rule.id) }}">Editar</a>
                <form method="post" action="{{ url_for('rules.delete_rule', rule_id=rule.id) }}" class="d-inline" onsubmit="return confirm('Tem certeza que deseja excluir esta regra?');">
                  {% if rule_alert_counts.get(rule.id, 0) > 20 %}
                    <input type="password" name="confirm_password" class="form-control form-control-sm d-inline-block me-2" style="width: 140px;" placeholder="Senha">
                  {% endif %}
                  <button class="btn btn-sm btn-outline-danger">Excluir</button>
                </form>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% else %}
  <div class="card border-0 shadow-sm p-5 text-center">
    <div class="mb-3" style="font-size: 3rem;">ü§ñ</div>
    <h4 class="fw-bold">Nenhuma regra criada</h4>
    <p class="text-muted">Voc√™ ainda n√£o possui bots monitorando partidas. Comece agora mesmo!</p>
    <div class="mt-4">
      <a class="btn btn-primary px-4" href="{{ url_for('rules.create_rule') }}">Criar Minha Primeira Regra</a>
    </div>
  </div>
{% endif %}
{% endblock %}
