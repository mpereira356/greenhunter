{% extends "base.html" %}
{% block title %}Configurações | GreenHunter{% endblock %}
{% block content %}
<div class="page-header">
  <div>
    <h1 class="page-title">Configurações</h1>
    <p class="page-subtitle">Conecte seu Telegram e gerencie suas preferências de notificação.</p>
  </div>
</div>

<div class="row g-4">
  <div class="col-lg-5">
    <div class="card border-0 shadow-sm mb-4">
      <div class="card-body">
        <h5 class="card-title">Dados pessoais</h5>
        <form method="post" class="mt-4">
          <input type="hidden" name="form_type" value="profile">
          <div class="mb-3">
            <label class="form-label">ID do usuário</label>
            <input class="form-control text-muted bg-light" value="{{ current_user.id }}" readonly disabled>
          </div>
          <div class="mb-3">
            <label class="form-label">Nome de usuário</label>
            <input class="form-control" name="username" value="{{ current_user.username or '' }}" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Email</label>
            <input class="form-control" name="email" value="{{ current_user.email or '' }}" placeholder="nome@exemplo.com">
          </div>
          <div class="mb-3">
            <label class="form-label">Senha atual</label>
            <input type="password" class="form-control" name="current_password" placeholder="Obrigatória para trocar senha">
          </div>
          <div class="mb-3">
            <label class="form-label">Nova senha</label>
            <input type="password" class="form-control" name="new_password" placeholder="Deixe vazio para manter">
          </div>
          <div class="mb-4">
            <label class="form-label">Confirmar nova senha</label>
            <input type="password" class="form-control" name="confirm_password" placeholder="Repita a nova senha">
          </div>
          <div class="d-grid gap-2">
            <button class="btn btn-primary" type="submit">Salvar dados</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  
  <div class="col-lg-7">
    <div class="card border-0 shadow-sm mb-4">
      <div class="card-body">
        <h5 class="card-title">Integração Telegram</h5>
        <form method="post" class="mt-4">
          <input type="hidden" name="form_type" value="telegram">
          <div class="mb-3">
            <label class="form-label">Telegram Bot Token</label>
            <input class="form-control" name="telegram_token" value="{{ current_user.telegram_token or '' }}" placeholder="Ex: 123456789:ABCdef...">
          </div>
          <div class="mb-3">
            <label class="form-label">Telegram Chat ID</label>
            <input class="form-control" name="telegram_chat_id" value="{{ current_user.telegram_chat_id or '' }}" placeholder="Ex: -100123456789">
          </div>
          <div class="mb-4">
            <div class="p-2 rounded bg-light border small d-flex justify-content-between align-items-center">
              <span class="text-muted fw-bold">STATUS:</span>
              {% if current_user.telegram_verified %}
                <span class="text-success fw-bold">Verificado</span>
              {% else %}
                <span class="text-danger fw-bold">Não verificado</span>
              {% endif %}
            </div>
          </div>
          <div class="d-grid gap-2">
            <button class="btn btn-primary" type="submit">Salvar alterações</button>
            <button class="btn btn-outline-secondary" form="test-telegram-form" type="submit">Enviar mensagem de teste</button>
          </div>
        </form>
        <form id="test-telegram-form" method="post" action="{{ url_for('settings.test_telegram') }}"></form>
      </div>
    </div>

    <div class="card border-0 shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Passo a passo do Telegram</h5>
        <div class="mt-4">
          <div class="d-flex gap-3 mb-4">
            <div class="brand-icon flex-shrink-0" style="width: 32px; height: 32px; font-size: 0.9rem;">1</div>
            <div>
              <h6 class="fw-bold mb-1">Crie seu Bot</h6>
              <p class="text-muted small mb-0">No Telegram, procure por <a href="https://t.me/botfather" target="_blank" class="fw-bold">@BotFather</a> e use o comando <code>/newbot</code> para gerar seu token.</p>
            </div>
          </div>
          
          <div class="d-flex gap-3 mb-4">
            <div class="brand-icon flex-shrink-0" style="width: 32px; height: 32px; font-size: 0.9rem;">2</div>
            <div>
              <h6 class="fw-bold mb-1">Obtenha o Chat ID</h6>
              <p class="text-muted small mb-0">Crie um grupo, adicione seu bot e o bot <a href="https://t.me/getidsbot" target="_blank" class="fw-bold">@getidsbot</a>. Ele informará o ID do chat (ex: -100...).</p>
            </div>
          </div>
          
          <div class="d-flex gap-3">
            <div class="brand-icon flex-shrink-0" style="width: 32px; height: 32px; font-size: 0.9rem;">3</div>
            <div>
              <h6 class="fw-bold mb-1">Vincule e teste</h6>
              <p class="text-muted small mb-0">Insira os dados acima, salve e clique em "Enviar mensagem de teste" para confirmar se está tudo funcionando.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
